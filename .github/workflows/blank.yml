os: linux
  git: 
    depth: 1
  addons: 
    apt: 
      update: 
        true
      packages: 
        aria2
        zstd
        xz-utils
  services: 
    docker
  before_install: 
    docker pull fr3akyphantom/droid-builder:latest
  before_script: 
    cd $HOME
    TWRP_SOURCE=\"https://github.com/PhantomZone54/twrp_sources_norepo/releases/download/v3.4.0-20201103/MinimalOmniRecovery-twrp-6.0-norepo-20201103.tzst\"
    aria2c -x16 -s8 --console-log-level=error --summary-interval=0 \"${TWRP_SOURCE}\" -o twrp.tzst || wget -q --show-progress --progress=bar:force \"${TWRP_SOURCE}\" -O twrp.tzst
  script: 
    cd $HOME/twrp/ && git clone https://github.com/LostOuija/Stylo6.git device/lge/mdh50lm
    rm -rf bootable/recovery && git clone https://github.com/omnirom/android_bootable_recovery -b android-9.0 --depth 1 bootable/recovery
    docker run --rm -i -e USER_ID=$(id -u) -e GROUP_ID=$(id -g) -v \"$(pwd):/home/builder/twrp/:rw,z\" -v \"${HOME}/.ccache:/srv/ccache:rw,z\" fr3akyphantom/droid-builder bash << EOF\ncd /home/builder/twrp/\nsource build/envsetup.sh\n# Choose build flavor as \"eng\" or \"userdebug\"\nBUILD_FLAVOR=\"eng\"\nlunch omni_mdh50lm-eng\nmake -j$(nproc --all) recoveryimage\nexit\nEOF\n
  after_success: 
    export version=$(cat bootable/recovery/variables.h | grep \"define TW_MAIN_VERSION_STR\" | cut -d '\"' -f2)
    cp $HOME/twrp/out/target/product/mdh50lm/recovery.img $HOME/twrp/TWRP-$version-mdh50lm-$(date +\"%Y%m%d\")-Unofficial.img
    cd $HOME/twrp/
  deploy: 
    provider: releases
    token: $GitOAUTHToken
    cleanup: false
    file_glob: true
    file: $HOME/twrp/*.img
    on: 
      tags: false
      repo: LostOuija/Stylo6
      branch: master
  branches: 
  only: 
      master
    except: 
      /^(?i:untagged)-.*$/
      /^v\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$
